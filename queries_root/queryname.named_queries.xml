<queries>
	<query name="net.cdolinc.student.invalid_email.flat" flattened="true" tags="myPowerQuery">
		<summary>Invalid Student Emails - Flat</summary>
		<description>PowerQuery to identify students with invalid email addresses</description>
		<columns>
			<column column="students.id">client_uid</column>
			<column column="students.dcid">id</column>
			<column column="students.enroll_status">action</column>
			<column column="psm_studentcontact.email">email</column>
		</columns>
		<sql>
			<![CDATA[
        SELECT 
        rownum as client_uid,
        students.dcid as id,
        'UPDATE' as action,
        students.student_web_id||'@365.cdolinc.net' as email 
        FROM students
        LEFT JOIN
			(
				SELECT students.dcid,
					psm_studentcontact.email
				FROM psm_studentcontact
				INNER JOIN psm_studentcontacttype
					ON psm_studentcontact.studentcontacttypeid = psm_studentcontacttype.id
					AND psm_studentcontacttype.name            = 'Self'
				INNER JOIN sync_studentmap
					ON psm_studentcontact.studentid = sync_studentmap.studentid
				INNER JOIN students
					ON sync_studentmap.studentsdcid = students.dcid
			) 
			std_email ON students.dcid    = std_email.dcid
        WHERE 
			(
				std_email.email           IS NULL
				OR std_email.email NOT LIKE '%@365.cdolinc.net'
			)
        AND students.enroll_status = 0 AND students.student_web_id IS NOT NULL
        ORDER BY students.last_name
        ]]>
		</sql>
	</query>
	<query name="net.cdolinc.sca.sequence.flat" flattened="true" tags="myPowerQuery">
		<summary>Invalid Contact Priority Order - Flat</summary>
		<description>PowerQuery to identify student contact associations that require sequence updates</description>
		<columns>
			<column column="STUDENTCONTACTASSOC.PERSONID">contactid</column>
			<column column="STUDENTCONTACTASSOC.STUDENTCONTACTASSOCID">deleted</column>
			<column column="STUDENTCONTACTASSOC.STUDENTCONTACTASSOCID">studentContactId</column>
			<column column="STUDENTCONTACTASSOC.CONTACTPRIORITYORDER">sequence</column>
			<column column="STUDENTS.DCID">dcid</column>
			<column column="STUDENTS.STUDENT_NUMBER">studentNumber</column>
			<column column="STUDENTS.FIRST_NAME">firstName</column>
			<column column="STUDENTS.MIDDLE_NAME">middleName</column>
			<column column="STUDENTS.LAST_NAME">lastName</column>
			<column column="SCHOOLS.ABBREVIATION">schoolAbbr</column>
			<column column="SCHOOLS.SCHOOL_NUMBER">schoolNumber</column>
			<column column="ORIGINALCONTACTMAP.ORIGINALCONTACTTYPE">originalContactType</column>
			<column column="GUARDIANSTUDENT.AUTOSEND_HOWOFTEN">autosendHowOften</column>
			<column column="GUARDIANSTUDENT.AUTOSEND_SUMMARY">emailSummary</column>
			<column column="GUARDIANSTUDENT.AUTOSEND_GRADEDETAIL">assignmentDetails</column>
			<column column="GUARDIANSTUDENT.AUTOSEND_ATTENDANCEDETAIL">attendanceDetails</column>
			<column column="GUARDIANSTUDENT.AUTOSEND_SCHOOLANNOUNCEMENTS">schoolAnnouncements</column>
			<column column="GUARDIANSTUDENT.AUTOSEND_BALANCEALERT">balanceAlert</column>
			<column column="GUARDIANNOTIFICATIONEMAIL.NOTIFICATIONEMAIL">notificationEmails</column>
			<column column="GUARDIANSTUDENT.GUARDIANSTUDENTID">canAccessData</column>
		</columns>
		<sql>
			<![CDATA[
				SELECT 
					"contactid",
					'false' AS "deleted",
					"studentContactId",
					"sequence",
					"dcid",
					"studentNumber",
					"firstName",
					"middleName",
					"lastName",
					"schoolAbbr",
					"schoolNumber",
					"originalContactType",
					"autosendHowOften",
					"emailSummary",
					"assignmentDetails",
					"attendanceDetails",
					"schoolAnnouncements",
					"balanceAlert",
					"notificationEmails",
					"canAccessData"
				FROM
					(
						SELECT 
							SCA.PERSONID "contactid",
							SCA.STUDENTCONTACTASSOCID "studentContactId",
							SCA.CONTACTPRIORITYORDER "sca_contactpriorityorder",
							ROW_NUMBER() Over (Partition BY SCA.STUDENTDCID Order By SCA.CONTACTPRIORITYORDER) "sequence",
							S.DCID "dcid",
							S.STUDENT_NUMBER "studentNumber",
							S.FIRST_NAME "firstName",
							S.MIDDLE_NAME "middleName",
							S.LAST_NAME "lastName",
							SCH.ABBREVIATION "schoolAbbr",
							SCH.SCHOOL_NUMBER "schoolNumber",
							OCM.ORIGINALCONTACTTYPE "originalContactType",
							nvl(GS.AUTOSEND_HOWOFTEN,0) "autosendHowOften", 
							DECODE(GS.AUTOSEND_SUMMARY, Null, 'false', 0, 'false', 1, 'true') "emailSummary",
							DECODE(GS.AUTOSEND_GRADEDETAIL, Null, 'false', 0, 'false', 1, 'true') "assignmentDetails",
							DECODE(GS.AUTOSEND_ATTENDANCEDETAIL, Null, 'false', 0, 'false', 1, 'true') "attendanceDetails",
							DECODE(GS.AUTOSEND_SCHOOLANNOUNCEMENTS, Null, 'false', 0, 'false', 1, 'true') "schoolAnnouncements",
							DECODE(GS.AUTOSEND_BALANCEALERT, Null, 'false', 0, 'false', 1, 'true') "balanceAlert",
							EMAIL_LIST.LIST_AGG "notificationEmails",
							NVL2(GS.GUARDIANSTUDENTID,'true','false') "canAccessData"
						FROM STUDENTCONTACTASSOC SCA
						LEFT JOIN PERSON P ON P.ID = SCA.PERSONID
						LEFT JOIN STUDENTS S ON S.DCID = SCA.STUDENTDCID
						LEFT JOIN SCHOOLS SCH ON SCH.SCHOOL_NUMBER = S.SCHOOLID
						LEFT JOIN ORIGINALCONTACTMAP OCM ON OCM.STUDENTCONTACTASSOCID = SCA.STUDENTCONTACTASSOCID
						LEFT JOIN GUARDIANPERSONASSOC GPA ON GPA.PERSONID = SCA.PERSONID
						LEFT JOIN GUARDIAN G ON G.GUARDIANID  = GPA.GUARDIANID AND GPA.PERSONID = P.ID
						LEFT JOIN GUARDIANSTUDENT GS ON GS.GUARDIANID = G.GUARDIANID AND GS.STUDENTSDCID = S.DCID
						LEFT JOIN
							(
								SELECT 
									GNE.GUARDIANSTUDENTID,
									ListAgg(GNE.NOTIFICATIONEMAIL, ', ') Within GROUP (ORDER BY GNE.NOTIFICATIONEMAIL) LIST_AGG
								FROM 
									GUARDIANNOTIFICATIONEMAIL GNE
								GROUP BY 
									GNE.GUARDIANSTUDENTID
							) EMAIL_LIST
						ON EMAIL_LIST.GUARDIANSTUDENTID = GS.GUARDIANSTUDENTID
					)
				WHERE "sca_contactpriorityorder" != "sequence"
				ORDER BY "studentContactId"
			]]>
		</sql>
	</query>
	<query name="net.cdolinc.contact.phone_sequence.flat" flattened="true" tags="myPowerQuery">
		<summary>Invalid Contact Phone Number Priority Order - Flat</summary>
		<description>PowerQuery to identify contact phone number associations that require sequence updates</description>
		<columns>
			<column column="PERSONPHONENUMBERASSOC.PERSONID">contactid</column>
			<column column="PERSONPHONENUMBERASSOC.PERSONPHONENUMBERASSOCID">deleted</column>
			<column column="PERSONPHONENUMBERASSOC.PERSONPHONENUMBERASSOCID">contactsPhoneId</column>
			<column column="PERSONPHONENUMBERASSOC.PHONENUMBERPRIORITYORDER">sequence</column>
			<column column="PERSONPHONENUMBERASSOC.ISPREFERRED">preferred</column>
			<column column="PERSONPHONENUMBERASSOC.PHONETYPECODESETID">phoneType</column>
			<column column="PERSONPHONENUMBERASSOC.PHONENUMBERID">phoneNumberId</column>
			<column column="PERSONPHONENUMBERASSOC.PHONENUMBERASENTERED">phoneNumber</column>
			<column column="PHONENUMBER.PHONENUMBEREXT">extension</column>
			<column column="PHONENUMBER.ISSMS">sms</column>
		</columns>
		<sql>
			<![CDATA[
				SELECT 
					"contactid",
					"deleted",
					"contactsPhoneId",
					"sequence",
					"preferred",
					"phoneType",
					"phoneNumberId",
					"phoneNumber",
					"extension",
					"sms"
				FROM
				(
					SELECT 
						personphonenumberassoc.PERSONID "contactid",
						'false' AS "deleted",
						personphonenumberassoc.PERSONPHONENUMBERASSOCID "contactsPhoneId",
						personphonenumberassoc.PHONENUMBERPRIORITYORDER "phoneNumberPriorityOrder",
						ROW_NUMBER() Over (Partition BY person.ID Order By personphonenumberassoc.PHONENUMBERPRIORITYORDER) "sequence",
						DECODE(personphonenumberassoc.ISPREFERRED, 0, 'false', 1, 'true') "preferred",
						(
							SELECT 
								CODE 
							FROM 
								CODESET 
							WHERE 
								CODESETID= personphonenumberassoc.PHONETYPECODESETID
						) "phoneType",
						personphonenumberassoc.PHONENUMBERID "phoneNumberId",
						personphonenumberassoc.PHONENUMBERASENTERED "phoneNumber",
						phonenumber.PHONENUMBEREXT "extension",
						DECODE(phonenumber.ISSMS, 0, 'false', 1, 'true') "sms"
					FROM person
					INNER JOIN personphonenumberassoc 
						ON person.ID = personphonenumberassoc.PERSONID
					LEFT JOIN phonenumber 
						ON personphonenumberassoc.PHONENUMBERID = phonenumber.PHONENUMBERID
					LEFT OUTER JOIN students 
						ON person.ID = students.PERSON_ID
					WHERE students.DCID IS NULL
				)
				WHERE "phoneNumberPriorityOrder" != "sequence"
				ORDER BY "contactsPhoneId"
			]]>
		</sql>
	</query>
	<query name="net.cdolinc.contact.invalid_phone_format.flat" flattened="true" tags="myPowerQuery">
		<summary>Invalid Contact Phone Number Format - Flat</summary>
		<description>PowerQuery to identify contact phone number associations that require phonenumberasentered updates</description>
		<columns>
			<column column="PERSONPHONENUMBERASSOC.PERSONID">contactid</column>
			<column column="PERSONPHONENUMBERASSOC.PERSONPHONENUMBERASSOCID">deleted</column>
			<column column="PERSONPHONENUMBERASSOC.PERSONPHONENUMBERASSOCID">contactsPhoneId</column>
			<column column="PERSONPHONENUMBERASSOC.PHONENUMBERPRIORITYORDER">sequence</column>
			<column column="PERSONPHONENUMBERASSOC.ISPREFERRED">preferred</column>
			<column column="PERSONPHONENUMBERASSOC.PHONETYPECODESETID">phoneType</column>
			<column column="PERSONPHONENUMBERASSOC.PHONENUMBERID">phoneNumberId</column>
			<column column="PERSONPHONENUMBERASSOC.PHONENUMBERASENTERED">phoneNumber</column>
			<column column="PHONENUMBER.PHONENUMBEREXT">extension</column>
			<column column="PHONENUMBER.ISSMS">sms</column>
		</columns>
		<sql>
			<![CDATA[
				SELECT 
					"contactid",
					"deleted",
					"contactsPhoneId",
					"sequence",
					"preferred",
					"phoneType",
					"phoneNumberId",
					"phoneNumber",
					"extension",
					"sms"
				FROM
					(
						SELECT 
						"contactid",
						"deleted",
						"contactsPhoneId",
						"sequence",
						"preferred",
						"phoneType",
						"phoneNumberId",
						"phoneNumberAsEntered",
						CASE
							WHEN LENGTH(clean_phone) = 10
							THEN SUBSTR(clean_phone, 1, 3)
							|| '-'
							|| SUBSTR(clean_phone, 4, 3)
							|| '-'
							|| SUBSTR(clean_phone, 7, 4)
							ELSE NULL
						END AS "phoneNumber",
						"extension",
						"sms"
					FROM
						(
							SELECT 
								personphonenumberassoc.PERSONID "contactid",
								'false' AS "deleted",
								personphonenumberassoc.PERSONPHONENUMBERASSOCID "contactsPhoneId",
								personphonenumberassoc.PHONENUMBERPRIORITYORDER "sequence",
								DECODE(personphonenumberassoc.ISPREFERRED, 0, 'false', 1, 'true') "preferred",
								(
									SELECT 
										CODESET.CODE
									FROM CODESET
									WHERE CODESET.CODESETID = personphonenumberassoc.PHONETYPECODESETID
								) "phoneType",
								personphonenumberassoc.PHONENUMBERID "phoneNumberId",
								personphonenumberassoc.PHONENUMBERASENTERED "phoneNumberAsEntered",
								SUBSTR(TRANSLATE(personphonenumberassoc.PHONENUMBERASENTERED, '1234567890'
								|| personphonenumberassoc.PHONENUMBERASENTERED, '1234567890'), 1, 10) AS clean_phone,
								phonenumber.PHONENUMBEREXT "extension",
								DECODE(phonenumber.ISSMS, 0, 'false', 1, 'true') "sms"
							FROM person
							INNER JOIN personphonenumberassoc
								ON person.ID = personphonenumberassoc.PERSONID
							LEFT OUTER JOIN phonenumber
								ON personphonenumberassoc.PHONENUMBERID = phonenumber.PHONENUMBERID
							LEFT OUTER JOIN students
								ON person.ID         = students.PERSON_ID
							WHERE students.DCID IS NULL
						)
					)
				WHERE "phoneNumberAsEntered" != "phoneNumber"
				AND "phoneNumberAsEntered" NOT LIKE '% x%'
				ORDER BY "contactsPhoneId"
			]]>
		</sql>
	</query>
	<query name="net.cdolinc.contact.duplicate_phone.flat" flattened="true" tags="myPowerQuery">
		<summary>Duplicate Contact Phone Number - Flat</summary>
		<description>PowerQuery to identify duplicate contact phone number associations</description>
		<columns>
			<column column="PERSONPHONENUMBERASSOC.PERSONID">contactid</column>
			<column column="PERSONPHONENUMBERASSOC.PERSONPHONENUMBERASSOCID">contactsPhoneId</column>
		</columns>
		<sql>
			<![CDATA[
				SELECT 
					"contactid",
					"contactsPhoneId"
				FROM
					(
						SELECT 
						personphonenumberassoc.personid "contactid",
						personphonenumberassoc.PERSONPHONENUMBERASSOCID "contactsPhoneId",
						ROW_NUMBER() Over (Partition BY person.ID, phonenumber.phonenumber Order By personphonenumberassoc.PHONENUMBERPRIORITYORDER) rn
						FROM person
						INNER JOIN personphonenumberassoc 
							ON person.ID = personphonenumberassoc.PERSONID
						LEFT OUTER JOIN phonenumber 
							on personphonenumberassoc.phonenumberid = phonenumber.phonenumberid
						LEFT OUTER JOIN students 
							ON person.ID = students.PERSON_ID
					WHERE students.DCID IS NULL
					)
				WHERE rn > 1
				ORDER BY "contactsPhoneId"
			]]>
		</sql>
	</query>
	<query name="net.cdolinc.contact.address_sequence.flat" flattened="true" tags="myPowerQuery">
	<summary>Invalid Contact Address Priority Order - Flat</summary>
	<description>PowerQuery to identify contact address associations that require sequence updates</description>
	<columns>
		<column column="PERSONADDRESSASSOC.PERSONID">contactid</column>
		<column column="PERSONADDRESSASSOC.PERSONADDRESSASSOCID">deleted</column>
		<column column="PERSONADDRESSASSOC.PERSONADDRESSASSOCID">contactsAddressId</column>
		<column column="PERSONADDRESSASSOC.ADDRESSPRIORITYORDER">sequence</column>
		<column column="PERSONADDRESSASSOC.PERSONADDRESSID">addressId</column>
		<column column="PERSONADDRESSASSOC.ADDRESSTYPECODESETID">addressType</column>
		<column column="PERSONADDRESS.STREET">street</column>
		<column column="PERSONADDRESS.LINETWO">linetwo</column>
		<column column="PERSONADDRESS.UNIT">unit</column>
		<column column="PERSONADDRESS.CITY">city</column>
		<column column="PERSONADDRESS.STATESCODESETID">state</column>
		<column column="PERSONADDRESS.COUNTRYCODESETID">country</column>
		<column column="PERSONADDRESS.POSTALCODE">postalcode</column>	
		<column column="PERSONADDRESSASSOC.STARTDATE">startDate</column>
		<column column="PERSONADDRESSASSOC.ENDDATE">endDate</column>
	</columns>
	<sql>
		<![CDATA[
			SELECT 
				"contactid",
				"deleted",
				"contactsAddressId",
				"sequence",
				"addressId",
				"addressType",
				"street",
				"linetwo",
				"unit",
				"city",
				"state",
				"country",
				"postalcode",
				"startDate",
				"endDate"
			FROM
				(
					SELECT 
					personaddressassoc.personid "contactid",
					'false' AS "deleted",
					personaddressassoc.PERSONADDRESSASSOCID "contactsAddressId",
					personaddressassoc.ADDRESSPRIORITYORDER "addressPriorityOrder",
					ROW_NUMBER() Over (Partition BY person.ID Order By personaddressassoc.ADDRESSPRIORITYORDER) "sequence",
					personaddressassoc.PERSONADDRESSID "addressId",
					(
						SELECT CODE 
						FROM CODESET 
						WHERE CODESETID= personaddressassoc.ADDRESSTYPECODESETID
					) "addressType",
					personaddress.STREET "street",
					personaddress.LINETWO "linetwo",
					personaddress.UNIT "unit",
					personaddress.CITY "city",
					(
						SELECT CODE 
						FROM CODESET 
						WHERE CODESETID= personaddress.STATESCODESETID
					) "state",
					(
						SELECT CODE 
						FROM CODESET 
						WHERE CODESETID= personaddress.COUNTRYCODESETID
					) "country",
					personaddress.POSTALCODE "postalcode",
					personaddressassoc.STARTDATE "startDate",
					personaddressassoc.ENDDATE "endDate"
				FROM person
				INNER JOIN personaddressassoc
					ON person.ID = personaddressassoc.PERSONID
				LEFT OUTER JOIN personaddress
					ON personaddressassoc.PERSONADDRESSID = personaddress.PERSONADDRESSID
				LEFT OUTER JOIN students
					ON person.ID         = students.PERSON_ID
				WHERE students.DCID IS NULL
				)
			WHERE "addressPriorityOrder" != "sequence"
			ORDER BY "contactsAddressId"
		]]>
	</sql>
</query>
<query name="net.cdolinc.allDemoData.students.demographics" flattened="true">
		<summary>CDOL: All Demo Data</summary>
		<description>List all demographic data for students and their first 6 contacts</description>
		<columns>
			<column column="students.STATE_STUDENTNUMBER" description="State Number">students.01_State_Number</column>
			<column column="StudentCoreFields.PrevStudentID" description="Old SMS Number">students.02_Old_SMS_Number</column>
			<column column="students.STUDENT_NUMBER" description="Student Number">students.03_Student_Number</column>
			<column column="students.FIRST_NAME" description="First Name">students.04_First_Name</column>
			<column column="students.MIDDLE_NAME" description="Middle Name">students.05_Middle_Name</column>
			<column column="students.LAST_NAME" description="Last Name">students.06_Last_Name</column>
			<column column="students.LASTFIRST" description="Last First">students.07_Last_First</column>
			<column column="U_STUDENT_ADDITIONAL_INFO.STUDENT_PREFERRED_NAME" description="Preferend Name">students.08_Preferred_Name</column>
			<column column="students.GENDER" description="Gender">students.09_Gender</column>
			<column column="students.dob" description="DoB">students.10_DoB</column>
			<column column="students.GRADE_LEVEL" description="Grade">students.11_Grade_Level</column>
			<column column="students.HOME_ROOM" description="Home Room">students.12_Home_Room</column>
			<column column="students.CLASSOF" description="Class Of">students.13_Class_of</column>
			<column column="students.FEDETHNICITY" description="Ethnicity">students.14_Ethnicity</column>
			<column column="STUDENTRACE.RACECD" description="Race">students.15_race</column>
			<column column="Gen.name" description="District of Residence">students.16_District_of_Residence</column>
			<column column="StudentCoreFields.FAMILY_REP" description="Family Rep">students.17_Family_Rep</column>
			<column column="students.MAILING_STREET" description="Mailing Street">students.18_Mailing_Street</column>
			<column column="students.MAILING_CITY" description="Mailing City">students.19_Mailing_City</column>
			<column column="students.MAILING_STATE" description="Mailing State">students.20_Mailing_State</column>
			<column column="students.MAILING_ZIP" description="Mailing Zip">students.21_Mailing_Zip</column>
			<column column="students.STREET" description="Street">students.22_Street</column>
			<column column="students.CITY" description="City">students.23_City</column>
			<column column="students.STATE" description="State">students.24_State</column>
			<column column="students.ZIP" description="Zip">students.25_Zip</column>
			<column column="students.HOME_PHONE" description="Home Phone">students.26_Home_Phone</column>
			<column column="U_STUDENT_ADDITIONAL_INFO.LOCKER_LOCATION" description="Locker Location">students.27_Locker_Location</column>
			<column column="students.LOCKER_NUMBER" description="Locker Number">students.28_Locker_Number</column>
			<column column="students.LOCKER_COMBINATION" description="Locker Combo">students.29_Locker_Combo</column>
			<column column="S_STU_NCEA_X.TITLEI_TF" description="Title 1">students.30_Title_1</column>
			<column column="S_STU_NCEA_X.DIAGNOSEDDISABILITY_TF" description="Disability">students.31_Disability</column>
			<column column="S_STU_NCEA_X.UNGRADED_TF" description="Ungraded">students.32_Ungraded</column>
			<column column="S_STU_NCEA_X.FEDERALNUTRITION" description="Free Reduced">students.33_Free_Reduced</column>
			<column column="S_STU_NCEA_X.SUBSIDIZEDTRANS_TF" description="Sub Transportation">students.34_Sub_Transportation</column>
			<column column="S_STU_NCEA_X.RELIGIOUSAFFILIATION" description="Religion">students.35_Religion</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_PARISH" description="Parish">students.36_Student_Parish</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_PARISH_CITY" description="Parish City">students.37_Student_Parish_City</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_PARISH_STATE" description="Parish State">students.38_Student_Parish_State</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_BAPTISM_DATE" description="Baptism Date">students.39_Baptism_Date</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_BAPTISM_PARISH" description="Baptism Parish">students.40_Baptism_Parish</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_BAPTISM_CITY" description="Baptism City">students.41_Baptism_City</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_BAPTISM_STATE" description="Baptism State">students.42_Baptism_State</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFESSION_DATE" description="Confession Date">students.43_Confession_Date</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFESSION_PARISH" description="Confession Parish">students.44_Confession_Parish</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFESSION_CITY" description="Confession City">students.45_Confession_City</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFESSION_STATE" description="Confession State">students.46_Confession_State</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_COMMUNION_DATE" description="Communion Date">students.47_Communion_Date</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_COMMUNION_PARISH" description="Communion Parish">students.48_Communion_Parish</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_COMMUNION_CITY" description="Communion City">students.49_Communion_City</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_COMMUNION_STATE" description="Communion State">students.50_Communion_State</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFIRMATION_DATE" description="Confirmation Date">students.51_Confirmation_Date</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFIRMATION_PARISH" description="Confirmation Parish">students.52_Confirmation_Parish</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFIRMATION_CITY" description="Confirmation City">students.53_Confirmation_City</column>
			<column column="U_STUDENT_SACRAMENTAL.STUDENT_CONFIRMATION_STATE" description="Confirmation State">students.54_Confirmation_State</column>
			<column column="students.DOCTOR_NAME" description="Doctor Name">students.55_Doctor_Name</column>
			<column column="students.DOCTOR_PHONE" description="Doctor Phone">students.56_Doctor_Phone</column>
			<column column="StudentCoreFields.Dentist_Name" description="Dentist Name">students.57_Dentist_Name</column>
			<column column="StudentCoreFields.dentist_phone" description="Dentist Phone">students.58_Dentist_Phone</column>
			<column column="students.ALERT_MEDICAL" description="Medical Alert">students.59_Medical_Alert</column>
			<column column="StudentCoreFields.ALLERGIES" description="Allergies">students.60_Allergies</column>
			<column column="students.ALERT_DISCIPLINE" description="Discipline Alert">students.61_Discipline_Alert</column>
			<column column="students.ALERT_OTHER" description="Other Alert">students.61_Other_Alert</column>
			<column column="students.LDAPENABLED" description="LDAP Enabled">students.62_LDAP_Enabled</column>
			<column column="students.STUDENT_ALLOWWEBACCESS" description="Student Web Access">students.63_Student_Web_Access</column>
			<column column="students.STUDENT_WEB_ID" description="Student Username">students.64_Student_Username</column>
			<column column="students.ALLOWWEBACCESS" description="Parent Web Access">students.65_Parent_Web_Access</column>
			<column column="students.WEB_ID" description="Parent Access ID">students.66_Parent_Access_ID</column>
			<column column="StudentCoreFields.SINGLEPARENTHSHLDFLAG" description="Single Parent Household">Students.67_Single_Parent_Household</column>
			<column column="students.Next_school" description="Next School">school.01_Next_School</column>
			<column column="SCHOOLS.name" description="School">school.02_School</column>
		</columns>
		<sql>
			<![CDATA[
					WITH pcontact as (
						SELECT DISTINCT
							s.dcid as studentdcid,
							sch.abbreviation school,
							s.student_number,
							s.lastfirst,
							s.grade_level,
							s.home_room, 
							p.id contactid,
							sca.contactpriorityorder as pcontactorder,
							precs.code Prefix,
							p.firstname, 
							p.middlename,
							p.lastname,
							CASE 
								WHEN p.firstname IS NULL AND p.lastname IS NULL 
								THEN '-No Name-' 
								ELSE p.firstname||' '||p.lastname 
							END ContactFirstLast,
							sufcs.code Suffix,
							sca.contactpriorityorder, 
							cs.code Relationship, 
							gcs.displayvalue Gender,
							p.employer, 
							Decode(p.isActive, 1, 'Active', 'Inactive') isactive,
							u.person_status,
							u.PERSON_MAIDEN_NAME,
							Decode(gs.studentsdcid, NULL, 'No', 'Yes') dataaccess,
							DECODE(scd.iscustodial, 1, 'Yes','No') iscustodial,
							DECODE(scd.liveswithflg, 1, 'Yes','No') liveswithflg,
							DECODE(scd.receivesmailflg, 1, 'Yes','No') receivesmailflg,
							DECODE(scd.isemergency, 1, 'Yes','No') isemergency,
							DECODE(scd.schoolpickupflg, 1, 'Yes','No') schoolpickupflg,
							u.person_religion,
							u.person_parish,
							u.person_parish_city, 
							u.person_parish_state,
							g.guardianid
							FROM Students s            
							JOIN schools sch ON (s.schoolid = sch.school_number)
							LEFT JOIN studentcontactassoc sca ON (s.dcid = sca.studentdcid)
							LEFT JOIN studentcontactdetail scd  ON (sca.studentcontactassocid = scd.studentcontactassocid)
							LEFT JOIN person p	ON  (sca.personid = p.ID)
							LEFT JOIN codeset cs	ON (cs.codesetid = scd.relationshiptypecodesetid)
							LEFT JOIN codeset precs	ON (precs.codesetid = p.PREFIXCODESETID)
							LEFT JOIN codeset sufcs	ON (sufcs.codesetid = p.SUFFIXCODESETID)
							LEFT JOIN codeset gcs	ON (gcs.codesetid = p.GENDERCODESETID)
							LEFT JOIN guardianpersonassoc gp ON (p.id = gp.personid)
							LEFT JOIN GUARDIAN g ON (gp.guardianid = g.guardianid)
							LEFT JOIN PCAS_ACCOUNT pcas on (g.ACCOUNTIDENTIFIER = pcas.PCAS_ACCOUNTTOKEN)
							LEFT JOIN PCAS_EMAILCONTACT PCASE ON (pcas.PCAS_ACCOUNTID = pcase.PCAS_ACCOUNTID)
							LEFT JOIN guardianstudent gs ON (s.dcid = gs.studentsdcid AND gp.guardianid = gs.guardianid)
							LEFT JOIN U_PERSON_ADDITIONAL_INFO U	ON  (p.ID = u.personid)
							WHERE s.enroll_status = 0
							ORDER BY s.lastfirst, sca.contactpriorityorder 
						)
						SELECT 
							A.STATE_STUDENTNUMBER AS "State_Number(UUID)",
							SCF.PrevStudentID as Old_SMS_Number,
							A.STUDENT_NUMBER,
							A.FIRST_NAME,
							A.MIDDLE_NAME,
							A.LAST_NAME ,
							A.LASTFIRST AS LastFirst,
							AD.STUDENT_PREFERRED_NAME,
							CASE WHEN A.GENDER= 'M' THEN 'Male' WHEN A.GENDER = 'F' THEN 'Female' ELSE '' End AS Gender,
							to_char(a.dob,'MM/DD/YYYY') AS Birthday,
							A.GRADE_LEVEL,
							A.HOME_ROOM,
							A.CLASSOF,
							CASE WHEN A.FEDETHNICITY = 1 THEN 'Hispanic / Latino' WHEN A.FEDETHNICITY = 0 THEN 'Not Hispanic / Latino' ELSE ' ' END AS "Fed_Ethnicity",
						(SELECT LISTAGG (RACECD, ', ') WITHIN GROUP (ORDER BY RACECD)
								FROM STUDENTRACE A2
								WHERE A2.STUDENTID = A.ID) as "RACE",
							G.name as "District of Residence",
							CASE WHEN SCF.FAMILY_REP= 1 THEN 'YES' WHEN SCF.FAMILY_REP=0 THEN 'NO' END AS Family_rep,
							A.MAILING_STREET,
							A.MAILING_CITY,
							A.MAILING_STATE,
							A.MAILING_ZIP,
							A.STREET as Physical_Street,
							A.CITY as Physical_City,
							A.STATE as Physical_State,
							A.ZIP as Physical_Zip,
							A.HOME_PHONE,
							AD.LOCKER_LOCATION,
							A.LOCKER_NUMBER,
							A.LOCKER_COMBINATION,
							CASE WHEN NCEA.TITLEI_TF= 1 THEN 'Yes' WHEN NCEA.TITLEI_TF= 0 THEN 'No' ELSE '' END AS Title_1,
							CASE WHEN NCEA.DIAGNOSEDDISABILITY_TF= 1 THEN 'Yes' WHEN NCEA.DIAGNOSEDDISABILITY_TF= 0 THEN 'No' ELSE '' END AS Disability,
							CASE WHEN NCEA.UNGRADED_TF= 1 THEN 'Yes' WHEN NCEA.UNGRADED_TF= 0 THEN 'No' ELSE '' END AS Ungraded,
							NCEA.FEDERALNUTRITION AS "Free_Reduced",
							CASE WHEN NCEA.SUBSIDIZEDTRANS_TF= 1 THEN 'Yes' WHEN NCEA.SUBSIDIZEDTRANS_TF= 0 THEN 'No' ELSE '' END AS Sub_Transport,
							CASE WHEN NCEA.RELIGIOUSAFFILIATION= 'C' THEN 'Catholic' WHEN NCEA.RELIGIOUSAFFILIATION= 'N' THEN 'Non-Catholic'ELSE '' END AS Religion,
							SAC.STUDENT_PARISH,
							SAC.STUDENT_PARISH_CITY,
							SAC.STUDENT_PARISH_STATE,
							to_char(SAC.STUDENT_BAPTISM_DATE,'MM/DD/YYYY')as "Baptism_Date",
							SAC.STUDENT_BAPTISM_PARISH,
							SAC.STUDENT_BAPTISM_CITY,
							SAC.STUDENT_BAPTISM_STATE,
							to_char(SAC.STUDENT_CONFESSION_DATE,'MM/DD/YYYY')as "Confession_Date",
							SAC.STUDENT_CONFESSION_PARISH,
							SAC.STUDENT_CONFESSION_CITY,
							SAC.STUDENT_CONFESSION_STATE,
							to_char(SAC.STUDENT_COMMUNION_DATE,'MM/DD/YYYY')as "Communion_Date",
							SAC.STUDENT_COMMUNION_PARISH,
							SAC.STUDENT_COMMUNION_CITY,
							SAC.STUDENT_COMMUNION_STATE,
							to_char(SAC.STUDENT_CONFIRMATION_DATE,'MM/DD/YYYY')as "Confirmation_Date",
							SAC.STUDENT_CONFIRMATION_PARISH,
							SAC.STUDENT_CONFIRMATION_CITY,
							SAC.STUDENT_CONFIRMATION_STATE,
							A.DOCTOR_NAME,
							A.DOCTOR_PHONE,
							SCF.Dentist_Name,
							SCF.dentist_phone,
							A.ALERT_MEDICAL AS Medical_Alert,
							SCF.ALLERGIES AS Allergies,
							A.ALERT_DISCIPLINE AS Discipline_Alert,
							A.ALERT_OTHER as Other_Alert,
							CASE WHEN A.LDAPENABLED= 1 THEN 'Yes' WHEN A.LDAPENABLED= 0 THEN 'No' ELSE '' END AS LDAP_Enabled,
							CASE WHEN A.STUDENT_ALLOWWEBACCESS= 1 THEN 'Yes' WHEN A.STUDENT_ALLOWWEBACCESS= 0 THEN 'No' ELSE '' END AS Student_Web_Access,
							A.STUDENT_WEB_ID AS Student_Username,
							CASE WHEN A.ALLOWWEBACCESS= 1 THEN 'Yes' WHEN A.ALLOWWEBACCESS= 0 THEN 'No' ELSE '' END AS Parent_Web_Access,
							A.WEB_ID AS Parent_Access_ID,                            
							SCF.SINGLEPARENTHSHLDFLAG AS "Single Parent Household",
							nxtsch.NAME as Next_school,
							B.NAME as school
						FROM  STUDENTS A
						INNER JOIN SCHOOLS B
							ON B.SCHOOL_NUMBER = A.SCHOOLID
						Left JOIN SCHOOLS nxtsch
							ON nxtsch.SCHOOL_NUMBER = A.Next_School
						INNER JOIN FTE Z
							ON Z.ID = A.FTEID
						LEFT JOIN U_STUDENT_SACRAMENTAL SAC
							ON SAC.STUDENTSDCID = A.DCID
						LEFT JOIN U_STUDENT_ADDITIONAL_INFO AD
							ON AD.STUDENTSDCID = A.DCID
						INNER JOIN StudentCoreFields SCF
							ON SCF.STUDENTSDCID =A.DCID
						LEFT JOIN S_STU_NCEA_X NCEA
							ON NCEA.STUDENTSDCID =A.DCID
						LEFT JOIN Gen G
							ON G.value = A.DistrictOfResidence AND G.cat = 'districts'
						LEFT JOIN pcontact  
							ON (pcontact.studentdcid = A.DCID AND pcontact.pcontactorder = 1)
						WHERE
							A.enroll_status in (-1,0)
						ORDER BY 
							A.lastfirst
        ]]>
		</sql>
	</query>
</queries>